{% extends 'store/base.html' %}

{% block content %}
<style>
    .admin-header {
        background: white;
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
    }

    .filter-section {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
    }

    .orders-table {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .table-custom {
        margin-bottom: 0;
    }

    .table-custom thead {
        background: linear-gradient(90deg, var(--dark-bg) 0%, var(--primary-color) 100%);
        color: white;
    }

    .table-custom thead th {
        border: none;
        padding: 1rem;
        font-weight: 600;
    }

    .table-custom tbody tr {
        transition: all 0.3s;
    }

    .table-custom tbody tr:hover {
        background: #f8f9fa;
        transform: scale(1.01);
    }

    .table-custom tbody td {
        padding: 1rem;
        vertical-align: middle;
    }

    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
        display: inline-block;
    }

    .status-pending {
        background: #fff3cd;
        color: #856404;
    }

    .status-completed {
        background: #d4edda;
        color: #155724;
    }

    .status-cancelled {
        background: #f8d7da;
        color: #721c24;
    }

    .btn-view {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
    }

    .btn-view:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
        color: white;
    }

    .order-number {
        font-weight: bold;
        color: var(--primary-color);
    }

    .empty-state {
        text-align: center;
        padding: 4rem;
        color: #999;
    }

    .empty-state i {
        font-size: 5rem;
        margin-bottom: 1rem;
    }
</style>

<div class="admin-header">
    <h1 style="font-weight: bold; color: var(--dark-bg); margin-bottom: 0.5rem;">
        <i class="fas fa-clipboard-list"></i> Gestión de Órdenes
    </h1>
    <p class="text-muted mb-0">Administra todas las ventas realizadas</p>
</div>

<!-- Filtros -->
<div class="filter-section">
    <form method="GET" class="row g-3 align-items-end">
        <div class="col-md-4">
            <label class="form-label fw-bold">
                <i class="fas fa-filter"></i> Filtrar por Estado
            </label>
            <select name="status" class="form-select" onchange="this.form.submit()">
                <option value="">Todos los estados</option>
                <option value="pending" {% if request.GET.status == 'pending' %}selected{% endif %}>Pendientes</option>
                <option value="completed" {% if request.GET.status == 'completed' %}selected{% endif %}>Completadas</option>
                <option value="cancelled" {% if request.GET.status == 'cancelled' %}selected{% endif %}>Canceladas</option>
            </select>
        </div>
        <div class="col-md-4">
            <a href="{% url 'admin_orders' %}" class="btn btn-outline-secondary">
                <i class="fas fa-redo"></i> Limpiar Filtros
            </a>
        </div>
    </form>
</div>

<!-- Tabla de Órdenes -->
<div class="orders-table">
    {% if orders %}
        <table class="table table-custom table-hover">
            <thead>
                <tr>
                    <th><i class="fas fa-hashtag"></i> Número de Orden</th>
                    <th><i class="fas fa-user"></i> Cliente</th>
                    <th><i class="fas fa-calendar"></i> Fecha</th>
                    <th><i class="fas fa-dollar-sign"></i> Total</th>
                    <th><i class="fas fa-info-circle"></i> Estado</th>
                    <th><i class="fas fa-credit-card"></i> Pago</th>
                    <th><i class="fas fa-cog"></i> Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                    <tr>
                        <td>
                            <span class="order-number">{{ order.order_number }}</span>
                        </td>
                        <td>
                            {% if order.customer %}
                                <i class="fas fa-user-circle"></i> {{ order.customer.username }}
                            {% else %}
                                <i class="fas fa-user-slash"></i> <span class="text-muted">Sin usuario</span>
                            {% endif %}
                        </td>
                        <td>
                            <i class="far fa-clock"></i> {{ order.created_at|date:"d/m/Y H:i" }}
                        </td>
                        <td>
                            <strong style="color: var(--primary-color);">${{ order.total }} MXN</strong>
                        </td>
                        <td>
                            {% if order.status == 'pending' %}
                                <span class="status-badge status-pending">
                                    <i class="fas fa-clock"></i> Pendiente
                                </span>
                            {% elif order.status == 'completed' %}
                                <span class="status-badge status-completed">
                                    <i class="fas fa-check-circle"></i> Completada
                                </span>
                            {% else %}
                                <span class="status-badge status-cancelled">
                                    <i class="fas fa-times-circle"></i> Cancelada
                                </span>
                            {% endif %}
                        </td>
                        <td>
                            {% if order.payment_status == 'paid' %}
                                <i class="fas fa-check text-success"></i> Pagado
                            {% else %}
                                <i class="fas fa-exclamation-triangle text-warning"></i> Pendiente
                            {% endif %}
                        </td>
                        <td>
                            <a href="{% url 'admin_order_detail' order.id %}" class="btn-view">
                                <i class="fas fa-eye"></i> Ver Detalle
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <h4>No hay órdenes</h4>
            <p class="text-muted">Las órdenes aparecerán aquí cuando se realicen ventas</p>
        </div>
    {% endif %}
</div>

<!-- Estadísticas Rápidas -->
<div class="row mt-4">
    <div class="col-md-4">
        <div class="card" style="border-radius: 15px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
            <div class="card-body text-center">
                <h3 style="color: var(--primary-color); font-weight: bold;">
                    {{ orders|length }}
                </h3>
                <p class="mb-0 text-muted">Total de Órdenes</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card" style="border-radius: 15px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
            <div class="card-body text-center">
                <h3 style="color: #28a745; font-weight: bold;">
                    {{ orders|length }}
                </h3>
                <p class="mb-0 text-muted">Completadas</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card" style="border-radius: 15px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
            <div class="card-body text-center">
                <h3 style="color: var(--primary-color); font-weight: bold;">
                    ${% widthratio orders|length 1 1000 %} MXN
                </h3>
                <p class="mb-0 text-muted">Total Ventas</p>
            </div>
        </div>
    </div>
</div>

{% endblock %}